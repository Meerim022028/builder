System.register(["./chunk-vendor.js","./chunk-frameworks.js"],(function(){"use strict";var e,t,n,s,o,r,i,c,l,a,u,d,m,g,f,h,p,b,j,y,S,v,q,A,L,w,E,T,k,x,_,C,M,I,H,R,P;return{setters:[function(a){e=a._,t=a.i,n=a.g,s=a.c,o=a.a,r=a.o,i=a.r,c=a.I,l=a.f},function(e){a=e.p,u=e.n,d=e.aF,m=e.z,g=e.b,f=e.ax,h=e.j,p=e.M,b=e.c,j=e.aG,y=e.aH,S=e.aI,v=e.aJ,q=e.aK,A=e.aw,L=e.aL,w=e.e,E=e.a8,T=e.t,k=e.ap,x=e.an,_=e.s,C=e.u,M=e.L,I=e.a0,H=e.aM,R=e.aN,P=e.aO}],execute:function(){class AutoFlushingQueue{constructor(e=50,t=30){this.elements=[],this.timer=null,this.callbacks=[],this.timeout=e,this.limit=t}push(e){this.timer&&(window.clearTimeout(this.timer),this.timer=null),this.elements.length>=this.limit&&this.flush(),this.elements.push(e),this.timer=window.setTimeout((()=>{this.flush()}),this.timeout)}onFlush(e){this.callbacks.push(e)}async flush(){const e=this.elements.splice(0,this.limit);0!==e.length&&await Promise.all(this.callbacks.map((t=>t(e))))}}const D=new Map;let $=class BatchDeferredContentElement extends HTMLElement{constructor(){super(...arguments),this.url="",this.csrf=null}connectedCallback(){this.csrf=this.querySelector("[data-csrf]"),this.queue.push(this)}get queue(){let e=D.get(this.url);return e||(e=this.buildAutoFlushingQueue(),D.set(this.url,e),e)}buildAutoFlushingQueue(){const e=new AutoFlushingQueue;return e.onFlush((async e=>{const t=new Map,n=new FormData,s=e.find((e=>e.csrf));if(s&&s.csrf){const e=s.csrf.value;n.set("authenticity_token",e)}for(const r in e){const s=e[r],o="item-"+r;t.set(o,s);for(const e of s.inputs)n.append(`items[${o}][${e.name}]`,e.value)}const o=await async function(e,t){const n=await fetch(e,{method:"POST",body:t,headers:{Accept:"application/json"}});if(n.ok){const e=await n.json(),t=new Map;for(const n in e)t.set(n,e[n]);return t}return new Map}(this.url,n);for(const[r,i]of o.entries()){t.get(r).replaceWith(a(document,i))}})),e}};e([t],$.prototype,"url",void 0),e([n],$.prototype,"inputs",void 0),$=e([s],$);const F=()=>{const e=document.querySelector(".js-branches-list"),t=document.querySelector("#spoof-warning"),n=document.querySelector(".commit-title");e&&t&&(e.parentElement.hidden=!0,t.hidden=!1,t.removeAttribute("aria-hidden"),n.classList.add("pb-1"))},N=document.querySelector("#async-branches-list");function B(e,t){return Array.from(document.querySelectorAll(".js-details-container.open.Details--on")).filter((n=>n.getAttribute(e)===t))}function U(e,t,n,s,o,r){const i=document.querySelector(".js-file-filter"),c=new URL(window.location.href,window.location.origin);if(!e&&!s){if(t||r)return;return c.search="",u(d(),"",c.toString())}const l=i.querySelector(".js-file-filter-form"),a=new FormData(l),m=n.filter((e=>!a.getAll("file-filters[]").includes(e))),g=o.filter((e=>!a.getAll("owned-by[]").includes(e)));for(const u of m)a.append("file-filters[]",u);for(const u of g)a.append("owned-by[]",u);const f=new URLSearchParams(a);f.has("file-filters[]")&&""!==f.toString()||f.set("file-filters[]",""),t&&f.set("w","1"),r&&f.set("manifests","true"),c.search=f.toString(),u(d(),"",c.toString())}function W(e){var t;t=e,document.querySelector(".js-file-filter-text").classList.toggle("color-text-link",t),function(e){const t=document.querySelector(".js-reset-filters"),n=document.querySelector(".js-commits-filtered");null==t||n||(t.hidden=!e)}(e),function(){const e=Q(),t=ne();for(const o of e)if(t){const e="0"===o.getAttribute("data-non-deleted-files-count");o.disabled=e}else o.disabled=!1;const n=document.querySelector(".js-deleted-files-container"),s=X();if(s&&n){const t=function(e){const t=e.find((e=>e.checked&&"0"!==e.getAttribute("data-deleted-files-count")));return Boolean(t)}(Array.from(e));n.classList.toggle("color-text-secondary",!t),s.disabled=!t}}(),function(){const e=Z(),t=document.querySelector(".js-file-filter-select-all-container"),n=e?"data-select-all-markup":"data-all-selected-markup",s=t.getAttribute(n);t.textContent=s,t.classList.toggle("color-text-secondary",!e),t.classList.toggle("color-text-link",e)}(),function(){const e=document.querySelector(".js-deleted-files-container");if(e){const t=ne()?"data-show-deleted-markup":"data-hide-deleted-markup",n=e.getAttribute(t);e.textContent=n}}(),function(){const e=document.querySelectorAll(".js-file-type-count");for(const t of e){const e=ne()?"data-non-deleted-file-count-markup":"data-all-file-count-markup",n=t.getAttribute(e);n&&(t.textContent=n)}}(),U(e,ee(),z(),G(),Y(),te())}function O(e){!function(){const e=X(),t=z(),n=document.querySelectorAll(".js-file"),s=Y(),o=V(),r=K();for(const i of n){let n=!0;const c=i.getAttribute("data-file-type");if(c&&(n=t.includes(c)),o&&n){i.hasAttribute("data-file-user-viewed")&&(n=!o.checked)}if(s.length>0&&n){n=(i.getAttribute("data-codeowners")||"").split(",").filter((e=>s.includes(e))).length>0}if(e&&e.checked&&n){"true"===i.getAttribute("data-file-deleted")&&(n=!1)}if(r&&r.checked&&n){i.hasAttribute("data-file-manifest")||(n=!1)}se(i,n)}}(),W(e)}function z(){return Array.from(Q()).filter((e=>e.checked)).map((e=>e.value))}function Q(){return document.querySelectorAll(".js-diff-file-type-option")}function X(){const e=document.querySelector(".js-deleted-files-toggle");if(e instanceof HTMLInputElement)return e}function V(){const e=document.querySelector(".js-viewed-files-toggle");if(e instanceof HTMLInputElement)return e}function K(){return document.querySelector(".js-manifests-option")}function J(){return Z()||ne()||G()}function G(){return Y().length>0}function Y(){return Array.from(document.querySelectorAll(".js-diff-owner-option")).filter((e=>e.checked)).map((e=>e.value))}function Z(){return z().length!==Q().length}function ee(){return new URLSearchParams(window.location.search).has("w")}function te(){const e=K();return!!e&&e.checked}function ne(){const e=X();return!!e&&e.checked}function se(e,t){const n=e.closest(".js-file.js-details-container");n.classList.toggle("open",t),n.classList.toggle("Details--on",t)}function oe(e){const t=Q();for(const n of t)n.checked=e}function re({currentTarget:e}){const t=e,n=t.hasAttribute("open");t.closest(".js-file-header").classList.toggle("has-open-dropdown",n)}N&&N.addEventListener("include-fragment-replaced",F),o("change",".js-diff-file-type-option",(function(){O(J())})),o("change",".js-diff-owner-option",(function(){O(G())})),o("change",".js-manifests-option",(function(){O(te())})),o("click",".js-file-filter-select-all",(function(){Z()&&(oe(!0),O(J()))})),o("change",".js-deleted-files-toggle",(function(){O(J())})),o("change",".js-viewed-files-toggle",(function(){O(J())})),r(".js-file-filter",(function(){J()?W(!0):U(!1,ee(),z(),G(),Y(),te())})),o("click",".js-file-header .js-details-target",(function({currentTarget:e}){if(!document.querySelector(".js-file-filter"))return;const t=e.closest(".js-details-container"),n=function(e){const t=e.getAttribute("data-file-type"),n=B("data-file-type",t),s=Array.from(document.querySelectorAll(".js-diff-file-type-option")).find((e=>e.value===t));if(!s)return!1;const o=s.checked!==n.length>0;return o&&(s.checked=n.length>0),o}(t),s=X();let o=!1;s&&(o=function(e,t){let n=!1;if("true"===e.getAttribute("data-file-deleted")){const e=B("data-file-deleted","true");n=t.checked!==(0===e.length),n&&(t.checked=0===e.length)}return n}(t,s));const r=V();let i=!1;r&&(i=function(e,t){let n=!1;if("true"===e.getAttribute("data-file-user-viewed")){const e=B("data-file-user-viewed","true");n=t.checked!==(0===e.length),n&&(t.checked=0===e.length)}return n}(t,r)),(n||o||i)&&W(J())})),o("details:toggled-group",".js-file.js-details-container",(function(e){e.target===e.currentTarget&&function(e){if(!document.querySelector(".js-file-filter"))return;oe(e);const t=X();t&&(t.checked=!e),W(J())}(e.detail.open)})),o("details:toggled",".js-file.js-details-container",(function(e){if(e.target!==e.currentTarget)return;const t=e.currentTarget;t.getBoundingClientRect().top<0&&f(t)})),m((()=>{const e=window.location.hash.slice(1);if(!e)return;const t=document.getElementsByName(e)[0];if(!t)return;const n=t.nextElementSibling;n&&n.matches(".js-file.js-details-container")&&(n.classList.add("open"),n.classList.add("Details--on"))})),r(".js-file-header-dropdown",{subscribe:e=>g(e,"toggle",re)});const ie="```suggestion",ce="```",le=new RegExp("```suggestion(?:.*)\n","i"),ae=new RegExp("```(\n|$)");function ue(e,t){const n=e.slice(0,t).split("\n");return e.split("\n")[n.length-1]}function de(e){const t=/^(\s+)/.exec(e);return t&&t[0]||""}function me(e,t,n=0){const s=t.substring(n,t.length),o=e.exec(s);return o?o.index+n:-1}function ge(e,t){const n=[];let s=0,o=-1;for(;(o=me(le,e,s))>-1;){s=o+ie.length;const t=me(ae,e,s);if(-1===t)return!1;s=t+ce.length,n.push([o,t])}return n.some((e=>t>e[0]&&t<e[1]))}function fe(e,t){const n=function(e){let t="```suggestion\n";return t+=e+"\n",t+=ce,t}(e),s=t.selectionStart,o=t.value,r=me(/\n/,o,s),i=""===o.trim(),c=ue(o,s),l=""===c.trim(),a="\n```".length;let u=o,d=0;if(i)u=n,d=u.length-a;else if(-1===r)l?(u=o+n,d=u.length-a):(u=[o,n].join("\n"),d=u.length-a);else if(l){const e=s-de(c).length,t=o.substring(0,e),i=o.substring(r,o.length);u=[t,n,i].join(""),d=u.length-i.length-a}else if(ge(o,s)){const e=me(/```/,o,s)+3,t=o.substring(0,e),r=o.substring(e,o.length);u=[t,"\n",n,r].join(""),d=u.length-r.length-a}else{const e=o.substring(0,r),t=o.substring(r,o.length);u=[e,"\n",n,t].join(""),d=u.length-t.length-a}h(t,u),t.focus(),t.setSelectionRange(d,d)}const he=".js-add-to-batch-enabled",pe=".js-unchanged-suggestion",be=".js-closed-pull",je=".js-viewing-subset-changes",ye=".js-validation-on-left-blob",Se=".js-validation-on-right-blob",ve=".js-outdated-comment",qe=".js-resolved-thread",Ae=".js-pending-review";function Le(e,t){const n=document.querySelectorAll(".js-apply-suggestion-button"),s=e.querySelector(".js-disabled-apply-suggestion-button");for(const o of n){const e=s.cloneNode(!0);Ee(e,t),o.closest("details").replaceWith(e)}}function we(e){const t=document.querySelector(".js-batched-suggested-changes-container");t&&t.classList.add("d-none");for(const n of document.querySelectorAll(".js-apply-single-suggestion"))n.classList.remove("d-none"),n.disabled=!0,n.setAttribute("aria-label",e);for(const n of document.querySelectorAll(".js-batched-suggested-changes-add"))n.classList.remove("d-none"),n.disabled=!0,n.setAttribute("aria-label",e);for(const n of document.querySelectorAll(".js-batched-suggested-changes-remove"))n.classList.add("d-none");for(const n of document.querySelectorAll(".js-focus-commit-suggestions-form-button"))n.classList.add("d-none");for(const n of document.querySelectorAll(".pending-batched-suggestion-label"))n.classList.add("d-none")}function Ee(e,t){e.setAttribute("aria-label",t),e.classList.remove("d-none")}function Te(e,t){const n=document.querySelector(".js-suggested-changes-inline-validation-template").cloneNode(!0);n.classList.remove("js-suggested-changes-inline-validation-template");n.querySelector(".js-suggested-changes-inline-error-message").textContent=e.trim();t.parentNode.insertBefore(n,t.nextSibling)}function ke(e){if(!document.querySelector(".js-suggested-changes-subset-files"))return;const t=e.querySelectorAll(".js-suggested-change-toolbar-item"),n=je,s=document.querySelector(n).textContent.trim();for(const o of t)o.disabled=!0,o.setAttribute("aria-label",s)}function xe(){const e=document.querySelector(".js-batched-suggested-changes-container");e&&setTimeout((()=>function(e){const t=e.closest(".js-review-state-classes").querySelectorAll("[data-pending-batched-suggestion]").length;for(const s of document.querySelectorAll(".js-pending-batched-suggested-changes-count"))s.textContent=String(t);const n=document.querySelector(".js-reenable-add-to-batch").textContent;for(const s of document.querySelectorAll("[data-batched-suggestion-reenable-sibling]"))s.removeAttribute("data-batched-suggestion-reenable-sibling"),s.removeAttribute("disabled"),s.setAttribute("aria-label",n);if(t>0){e.hidden=!1;const t=e.querySelector(".js-batched-suggested-changes-toggle");t.classList.add("anim-pulse-in"),t.addEventListener("animationend",(()=>t.classList.remove("anim-pulse-in")),{once:!0});for(const e of document.querySelectorAll(".js-apply-single-suggestion"))e.classList.add("d-none");for(const e of document.querySelectorAll(".js-batched-suggested-changes-add")){const t=e.closest(".js-suggested-change-form-container");"true"===t.getAttribute("data-pending-batched-suggestion")||"true"===t.getAttribute("data-comment-pending")||"true"===t.getAttribute("data-outdated-comment")?e.classList.add("d-none"):e.classList.remove("d-none"),"true"===e.getAttribute("data-batched-suggestion-disabled-by-sibling")&&(e.removeAttribute("data-batched-suggestion-disabled-by-sibling"),e.setAttribute("disabled","disabled"),e.setAttribute("aria-label",document.querySelector(".js-one-suggestion-per-line").textContent))}for(const e of document.querySelectorAll(".js-batched-suggested-changes-remove"))"true"===e.closest(".js-suggested-change-form-container").getAttribute("data-pending-batched-suggestion")?e.classList.remove("d-none"):e.classList.add("d-none");for(const e of document.querySelectorAll(".js-focus-commit-suggestions-form-button")){const t=e.closest(".js-suggested-change-form-container"),n="true"===t.getAttribute("data-comment-pending"),s="true"===t.getAttribute("data-outdated-comment"),o="true"===t.getAttribute("data-resolved-comment"),r="left"===e.closest(".js-inline-comments-container").querySelector('input[name="side"]').value;n||s||o||r?e.classList.add("d-none"):e.classList.remove("d-none")}for(const e of document.querySelectorAll(".pending-batched-suggestion-label"))"true"===e.closest(".js-suggested-change-form-container").getAttribute("data-pending-batched-suggestion")?e.classList.remove("d-none"):e.classList.add("d-none")}else{e.hidden=!0;for(const e of document.querySelectorAll(".js-apply-single-suggestion"))e.classList.remove("d-none");for(const e of document.querySelectorAll(".js-batched-suggested-changes-add"))e.classList.remove("d-none");for(const e of document.querySelectorAll(".js-batched-suggested-changes-remove"))e.classList.add("d-none");for(const e of document.querySelectorAll(".js-focus-commit-suggestions-form-button"))e.classList.add("d-none");for(const e of document.querySelectorAll(".pending-batched-suggestion-label"))e.classList.add("d-none")}}(e)))}function _e(e,t){const n=e.querySelector("input[name=commit_title]"),s=e.querySelector("textarea[name=commit_message]");let o=n.value.trim();""===o&&(o=n.defaultValue);const r=s.value.trim();""!==r&&(o=`${o}\n\n${r}\n`),n.disabled=!0,s.disabled=!0;const i=document.createElement("input");i.setAttribute("type","hidden"),i.setAttribute("name","message"),i.value=o,e.appendChild(i);const c=document.createElement("input");c.setAttribute("type","hidden"),c.setAttribute("name","changes"),c.value=JSON.stringify(t),e.appendChild(c)}function Ce(e,t){const n=e.nextElementSibling;return n&&n.matches(t)?n:null}function Me(e){const t=e.querySelector(".js-toggle-file-notes");t instanceof HTMLInputElement&&h(t,!0)}function Ie(){for(const e of document.querySelectorAll(".file .js-inline-comments-container")){const t=e.querySelectorAll(".js-comments-holder > *").length>0,n=e.querySelector(".js-inline-comment-form-container"),s=!!n&&n.classList.contains("open");t||s||e.remove()}}function He(e){const t=document.querySelector(e).firstElementChild.cloneNode(!0),n=t.querySelector("textarea");return n instanceof HTMLTextAreaElement&&(n.value=""),t}async function Re(e){const t=e.querySelector(".js-suggestion-button-placeholder");if(!t)return;const n=t.getAttribute("data-src-base");if(!n)return;const s=new URL(n,window.location.origin),o=t.closest(".js-inline-comment-form")||t.closest(".js-comment-update");if(!(o instanceof HTMLFormElement))return;const r=function(e,t){const n=new URLSearchParams(e.search.slice(1)),s=t.elements.namedItem("in_reply_to")||t.elements.namedItem("comment_id");if(s instanceof HTMLInputElement&&s.value)return n.append("comment_id",s.value),n;const o=t.elements.namedItem("path"),r=t.elements.namedItem("start_side"),i=t.elements.namedItem("start_line"),c=t.elements.namedItem("side"),l=t.elements.namedItem("line"),a=t.elements.namedItem("start_commit_oid"),u=t.elements.namedItem("end_commit_oid"),d=t.elements.namedItem("base_commit_oid");return o instanceof HTMLInputElement&&r instanceof HTMLInputElement&&i instanceof HTMLInputElement&&c instanceof HTMLInputElement&&l instanceof HTMLInputElement&&a instanceof HTMLInputElement&&u instanceof HTMLInputElement&&d instanceof HTMLInputElement?(n.append("path",o.value),n.append("start_side",r.value),n.append("start_line",i.value),n.append("end_side",c.value),n.append("end_line",l.value),n.append("start_commit_oid",a.value),n.append("end_commit_oid",u.value),n.append("base_commit_oid",d.value),n):null}(s,o);if(!r)return;s.search=r.toString();const i=await b(document,s.toString());t.innerHTML="",t.appendChild(i)}function Pe(e,t,n,s){if(e.classList.remove("color-bg-success","color-bg-danger"),!s)return"right"===n?(e.classList.add("color-green-6"),void(e.textContent="+"+t)):"left"===n?(e.classList.add("color-text-danger"),void(e.textContent="-"+t)):void(e.textContent=String(t));e.textContent=t}o("click",".js-suggested-change-toolbar-item",(function(e){const t=e.currentTarget;t instanceof HTMLButtonElement&&!t.disabled&&function(e){const t=e.getAttribute("data-lines");null!=t&&fe(t,e.closest(".js-suggested-changes-container").querySelector(".js-comment-field"))}(t)})),o("click",".js-refresh-after-suggestion",(function(){window.location.reload()})),r(".js-inline-comments-container",{add(e){ke(e)}}),r(".js-preview-body .js-apply-changes",{add(e){const t=e.closest(".js-suggested-changes-container");if(!t)return e.remove();const n=document.querySelector(Se).textContent,s=document.querySelector(ye).textContent,o=e.closest(".js-suggested-changes-blob");if(""!==t.getAttribute("data-thread-side")){if("left"===t.getAttribute("data-thread-side"))return Te(s,o),e.remove()}else{const t=e.closest(".js-inline-comment-form"),n=t.querySelector('input[name="side"]');if(!t||!n)return e.remove();if(t&&"left"===n.value)return Te(s,o),e.remove()}const r=e.previousElementSibling,i=r.querySelector(".js-blob-code-deletion"),c=r.querySelectorAll(".js-blob-code-addition");if(!i||0===c.length)return;if(i.textContent===Array.from(c).map((e=>e.textContent)).join("\n"))return Te(n,o),e.remove();e.remove()}}),r(".js-comment-body .js-apply-changes",{add(e){const t=e.closest(".js-suggested-changes-container");if(!t)return e.remove();const n=t.querySelector(".js-suggested-changes-template");if(!(n instanceof HTMLTemplateElement))return e.remove();const s=n.content.cloneNode(!0),o=s.querySelector(".js-disabled-apply-suggestion-button");let r;try{r=s.querySelector(".js-batched-suggested-changes-add")}catch(h){if("QueryError"!==h.name)throw h}if(document.querySelectorAll(".js-suggested-changes-files-tab").length){const e=document.querySelector(he).textContent;r&&(r.removeAttribute("disabled"),r.setAttribute("aria-label",e))}const i=document.querySelector(".js-pull-header-details"),c=i&&"true"===i.getAttribute("data-pull-is-open"),l=e.closest(".js-resolvable-timeline-thread-container"),a="true"===n.getAttribute("data-comment-pending"),u=t.classList.contains("js-selection-contains-deletions");if(l&&"true"===l.getAttribute("data-resolved")){const t=document.querySelector(qe).textContent,n=s.querySelector("details");return n&&n.remove(),Ee(o,t),r&&(r.setAttribute("disabled","disabled"),r.setAttribute("aria-label",t)),e.replaceWith(s)}if(!c){const t=document.querySelector(be).textContent;return Ee(o,t),r&&(r.setAttribute("disabled","disabled"),r.setAttribute("aria-label",t)),e.replaceWith(s)}if(a){const t=document.querySelector(Ae).textContent;return s.querySelector("details").remove(),Ee(o,t),r&&(r.setAttribute("disabled","disabled"),r.setAttribute("aria-label",t)),e.replaceWith(s)}if(u){const t=document.querySelector(ye).textContent;return s.querySelector("details").remove(),Ee(o,t),r&&(r.setAttribute("disabled","disabled"),r.setAttribute("aria-label",t)),e.replaceWith(s)}const d=document.querySelector(".js-suggested-changes-subset-files"),m="true"===n.getAttribute("data-outdated-comment");if(d||m){let t;return d?t=document.querySelector(je).textContent:m&&(t=document.querySelector(ve).textContent),s.querySelector("details").remove(),Ee(o,t),r&&(r.setAttribute("disabled","disabled"),r.setAttribute("aria-label",t)),e.replaceWith(s)}const g=s.querySelector(".js-single-suggested-change-form"),f=e.closest(".js-suggested-changes-blob");if(f){const e=f.querySelector(".js-blob-code-deletion"),t=f.querySelectorAll(".js-blob-code-addition");if(!e)return;const n=e.textContent,i=Array.from(t).map((e=>e.textContent));if(i.length>0&&n===i.join("\n")){const e=document.querySelector(pe).textContent;s.querySelector("details").remove(),Ee(o,e),r&&(r.setAttribute("disabled","disabled"),r.setAttribute("aria-label",e))}else for(const s of i){const e=document.createElement("input");e.setAttribute("type","hidden"),e.setAttribute("name","value[]"),e.value=s,g.appendChild(e)}}e.replaceWith(s)}}),r(".js-pull-header-details",{add(e){const t="true"===e.getAttribute("data-pull-is-open"),n=document.querySelector(".js-suggested-changes-template");if(t||!(n instanceof HTMLTemplateElement))return;const s=n.content,o=document.querySelector(be).textContent;Le(s,o),we(o)}}),r(".js-suggested-changes-subset-files",{add(){const e=document.querySelector(".js-suggested-changes-template");if(!(e instanceof HTMLTemplateElement))return;const t=e.content,n=document.querySelector(je).textContent;Le(t,n),we(n)}}),o("click",".js-apply-suggestion-button",(async function(e){const t=e.currentTarget.parentElement;if(t){const e=t.querySelector(".js-suggestion-commit-title");setTimeout((()=>e.focus()),1)}})),o("click",".js-dismiss-suggested-change-onboarding-notice",(async function(e){const t=e.currentTarget.getAttribute("data-url"),n=e.currentTarget.parentElement.querySelector(".js-data-url-csrf"),s=new FormData;s.append("notice","suggested_changes_onboarding_prompt");if((await fetch(t,{method:"POST",mode:"same-origin",body:s,headers:{"Scoped-CSRF-Token":n.value,"X-Requested-With":"XMLHttpRequest"}})).ok){const e=document.querySelectorAll(".js-suggested-change-onboarding-notice");for(const t of e)t.remove()}})),p("keypress",".js-comment-field",(function(e){if("Enter"===e.key){(function(e){const t=e.selectionStart;if(!ge(e.value,t))return!1;const n=e.value,s=ue(n,t);if(null===s)return!1;const o="\n"+de(s),r=n.substr(0,t)+o+n.substr(t);h(e,r);const i=t+o.length;return e.setSelectionRange(i,i),!0})(e.target)&&e.preventDefault()}})),p("keypress",".js-suggestion-commit-message",(function(e){const t=e.currentTarget;"Enter"===e.key&&t.setAttribute("rows","3")})),o("click",".js-batched-suggested-changes-add",(function(e){const t=e.target,n=t.closest(".js-suggested-change-form-container");if("true"===n.getAttribute("data-comment-pending")||"true"===n.getAttribute("data-outdated-comment")||"true"===t.getAttribute("data-batched-suggestion-disabled-by-sibling"))return;n.setAttribute("data-pending-batched-suggestion","true");const s=t.closest(".js-inline-comments-container");for(const o of s.querySelectorAll(".js-batched-suggested-changes-add"))o.setAttribute("data-batched-suggestion-disabled-by-sibling","true");t.removeAttribute("data-batched-suggestion-disabled-by-sibling"),xe()})),o("click",".js-batched-suggested-changes-remove",(function(e){e.currentTarget.closest(".js-suggested-change-form-container").removeAttribute("data-pending-batched-suggestion");const t=e.currentTarget.closest(".js-inline-comments-container");for(const n of t.querySelectorAll(".js-batched-suggested-changes-add"))n.setAttribute("data-batched-suggestion-reenable-sibling","true");xe()})),o("click",".js-focus-commit-suggestions-form-button",(function(e){e.preventDefault(),window.location.href="#clear-commit-suggestions",window.location.href="#commit-suggestions"})),o("click",".js-dismiss-batched-suggested-changes-onboarding-notice",(async function(e){const t=e.currentTarget.getAttribute("data-url"),n=e.currentTarget.parentElement.querySelector(".js-data-url-csrf"),s=new FormData;s.append("notice","batched_suggested_changes_onboarding_prompt");if((await fetch(t,{method:"POST",mode:"same-origin",body:s,headers:{"Scoped-CSRF-Token":n.value,"X-Requested-With":"XMLHttpRequest"}})).ok)for(const o of document.querySelectorAll(".js-batched-suggested-change-onboarding-notice"))o.remove()})),o("click",".js-single-suggested-change-form .js-suggested-changes-submit",(function(e){const t=e.currentTarget.closest(".js-single-suggested-change-form"),n=Array.from(t.querySelectorAll('input[name="value[]"]')).map((e=>e.value)),s=[{commentId:t.querySelector("input[name=comment_id]").value,path:t.querySelector("input[name=path]").value,suggestion:n}];_e(t,s)})),i(".js-single-suggested-change-form",(async function(e,t){const n=e.closest(".js-suggested-change-form-container"),s=e.closest("details"),o=n.querySelector(".js-suggestion-applied"),r=e.closest(".js-suggested-changes-contents").querySelector(".js-error-message-placeholder");try{await t.json(),o.classList.remove("d-none");n.querySelector(".js-batched-suggested-changes-add").classList.add("d-none"),s.remove(),window.location.reload()}catch(i){if("QueryError"!==i.name){const t=i.response.json&&i.response.json.error,o=r.querySelector(".js-error-message");r.hidden=!1,o.textContent=t,n.prepend(r);e.closest(".js-suggested-change-form-container").querySelector(".js-batched-suggested-changes-add").classList.add("d-none"),s.remove()}}})),o("click",".js-suggestion-batch-submit",(function(e){const t=e.currentTarget.closest(".js-batched-suggested-changes-form"),n=[];for(const s of document.querySelectorAll("[data-pending-batched-suggestion]")){const e=s.querySelector(".js-single-suggested-change-form"),t=Array.from(e.querySelectorAll('input[name="value[]"]')).map((e=>e.value));n.push({commentId:e.querySelector("input[name=comment_id]").value,path:e.querySelector("input[name=path]").value,suggestion:t})}_e(t,n)})),i(".js-batched-suggested-changes-form",(async function(e,t){try{await t.json();e.closest(".js-batched-suggested-changes-container").hidden=!0,window.location.reload()}catch(n){const t=n.response.json&&n.response.json.error,s=e.closest(".js-batched-suggested-changes-container").querySelector(".js-error-message-container");s.querySelector(".js-error-message").textContent=t,s.hidden=!1}})),r(".js-files-tab-stale",{add(){const e=document.querySelector(".js-batched-suggested-changes-container");e&&setTimeout((()=>{e.hidden=!0}))}}),o("click",".js-add-single-line-comment",(function(e){const t=e.currentTarget;Me(t.closest(".file"));const n=function(e){const t=e.closest("tr"),n=Ce(t,".js-inline-comments-container");if(n instanceof Element){const e=Array.from(n.querySelectorAll(".js-inline-comment-form")).pop();return e instanceof HTMLFormElement&&$e(e,t.querySelector("button.js-add-line-comment")),n}}(t)||function(e){const t=e.closest("tr"),n=He("#js-inline-comments-single-container-template"),s=n.querySelector(".js-inline-comment-form");s instanceof HTMLFormElement&&$e(s,e);return t.after(n),n}(t),s=Array.from(n.querySelectorAll(".js-line-comments")).pop();j(s)})),o("click",".js-add-split-line-comment",(function(e){const t=e.currentTarget;Me(t.closest(".file"));const n=t.closest("tr"),s="addition"===t.getAttribute("data-type")?"js-addition":"js-deletion",o=function(e,t,n){const s=e.querySelector(".js-line-comments."+t);if(s){return $e(Array.from(s.querySelectorAll(".js-inline-comment-form")).pop(),n),s}const o=He("#js-inline-comments-split-form-container-template");o.classList.add(t);const r=o.querySelector(".js-inline-comment-form");r instanceof HTMLFormElement&&$e(r,n);const i=e.querySelectorAll("."+t);i[i.length-1].after(o);for(const c of i)c.remove();return o}(function(e){let t=Ce(e,".js-inline-comments-container");return t||(t=He("#js-inline-comments-split-container-template"),e.after(t),t)}(n),s,t),r=Array.from(o.querySelectorAll(".js-line-comments")).pop();j(r)})),i(".js-inline-comment-form",(async function(e,t){let n;!function(e){const t=e.querySelector(".js-comment-form-error");t&&(t.hidden=!0,t.textContent=null)}(e);try{n=await t.json()}catch(c){if(c.response){let t;try{t=c.response.json}catch(l){}if(t)return void function(e,t){const n=e.querySelector(".js-comment-form-error");let s;s=t.errors?Array.isArray(t.errors)?t.errors.join(", "):t.errors:"There was an error posting your comment.";n.textContent=s,n.style.display="block",n.hidden=!1,n.classList.remove("d-none")}(e,t)}throw c}const s=n.json,o=s.inline_comment,r=e.closest(".js-line-comments");o&&r.querySelector(".js-comments-holder").append(a(document,o));const i=s.inline_comment_thread;i&&r.replaceWith(a(document,i)),y(e)})),document.addEventListener("session:resume",(function(e){const t=e.detail;!function(e){const[t,n]=e.match(/^new_inline_comment_(?:discussion|diff)_(?:[\w-]+)_(\d+)_(\d+)$/)||[];if(!t)return;const s=document.querySelector(`.js-inline-comment-form input[name='in_reply_to'][value='${n}']`);if(!s)return;const o=s.closest(".js-line-comments");o&&j(o)}(t.targetId),function(e){const[t,n]=e.match(/^new_inline_comment_diff_(?:[\w-]+)_(\d+)$/)||[];if(!t)return;const s=document.querySelector(`.js-add-line-comment[data-anchor='${t}'][data-position='${n}']`);s&&s.click()}(t.targetId)})),r(".js-comment",{remove:Ie}),o("inlinecomment:focus",".js-inline-comment-form-container",(function(e){const t=e.target.querySelector(".js-suggested-changes-container");t&&Re(t)})),r(".js-suggested-changes-container.is-comment-editing",(e=>{Re(e)})),document.addEventListener("inlinecomment:collapse",(()=>{Ie()}));const De={R:"right",L:"left"};function $e(e,t){const n=["type","path","position","line","side","original-line"];for(const c of n){const n=e.elements.namedItem(c);if(n instanceof HTMLInputElement){const e=t.getAttribute("data-"+c)||"";n.value=e}}!function(e,t){const n=q();if(!n)return;if(n.end.is(n.start))return;if(!S(t,n))return void v();const{start:{lineNumber:s},end:{lineNumber:o}}=n;let{start:{side:r},end:{side:i}}=n;const c=Number(t.getAttribute("data-line")),l=t.getAttribute("data-side");if(c!==o||!n.end.isContext()&&l!==De[i])return void v();const a=De[r],u=e.elements.namedItem("start_line"),d=e.elements.namedItem("start_side"),m=e.elements.namedItem("line"),g=e.elements.namedItem("side"),f=e.elements.namedItem("preview_start_side"),h=e.elements.namedItem("preview_side");if(u instanceof HTMLInputElement&&d instanceof HTMLInputElement&&m instanceof HTMLInputElement&&g instanceof HTMLInputElement&&f instanceof HTMLInputElement&&h instanceof HTMLInputElement){u.value=String(s),d.value=a,d.value=f.value=d.value,h.value=g.value;const t=u.value;r=d.value;const o=m.value;i=g.value;const c=e.closest(".js-inline-comment-form-container");if(t&&o){const e=c.querySelector(".js-multi-line-preview"),s=e.querySelector(".js-multi-line-preview-start"),l=e.querySelector(".js-multi-line-preview-end"),a=n.start.isContext(),u=n.end.isContext();Pe(s,t,r,a),Pe(l,o,i,u),e.hidden=!1,c.classList.add("is-multiline")}else c.querySelector(".js-multi-line-preview").hidden=!0,c.classList.remove("is-multiline");ke(c)}}(e,t);const s=t.getAttribute("data-position")||"",o=t.getAttribute("data-anchor")||"",r=e.querySelector(".js-comment-field"),i=r.id.replace(/^r\d+ /,"").replace("${anchor}",o).replace("${position}",s);for(const c of e.querySelectorAll(`[for="${r.id}"]`))c.setAttribute("for",i);r.id=i}function Fe(e){const t=Ne();if(!t)return;Be(e,t);const n=function(e,t){const n=function(e,t){const n=/^(diff-[0-9a-f]{32})(?:[L|R]\d+)?$/.exec(t);if(!n)return;const s=n[1],o=e.querySelector(`a[name='${s}']`);if(!o)return;const r=o.nextElementSibling;if(r&&!r.querySelector(".js-diff-load-container"))return;return r}(e,t);if(n)return n;return function(e,t){const n=/^(?:r|commitcomment-)(\d+)$/.exec(t);if(!n)return;const s=n[1],o=e.querySelector("#diff-with-comment-"+s);if(!o)return;return o.closest(".js-file")}(e,t)}(e,t);n&&(f(n),Ue(n))}function Ne(){return window.location.hash.slice(1)}function Be(e,t){let n;n=t.match(/^diff-.+[LR]\d+-[LR]\d+/)?A(e.ownerDocument,t.substring(0,t.indexOf("-",5))):A(e.ownerDocument,t),n&&e.contains(n)&&(L(n),f(n))}function Ue(e){const t=e.querySelector(".js-diff-entry-loader"),n=e.querySelector(".js-diff-placeholder"),s=e.querySelector("button.js-diff-load"),o=e.querySelector(".js-button-text");n.setAttribute("fill","url('#animated-diff-gradient')"),o.textContent=s.getAttribute("data-disable-with")||"",s.disabled=!0;const r=new URL(t.getAttribute("data-fragment-url")||"",window.location.origin);return t.src=r.toString(),t.data}function We(e,t,n){const s=Array.from(e.querySelectorAll('[role="menuitem"]'));let o=s.indexOf(t),r=s.indexOf(n);if(-1===o)throw new Error("Couldn't find startIndex in container");if(-1===r)throw new Error("Couldn't find endItem in container");Oe(e),s[r].classList.add("is-last-in-range"),o>r&&([o,r]=[r,o]);for(const i of s.slice(o,r+1))i.classList.add("is-range-selected")}function Oe(e){for(const t of e.querySelectorAll('[role="menuitem"]'))t.classList.remove("is-range-selected","is-last-in-range")}r(".js-diff-progressive-container",(function(e){Fe(e);const t=e.querySelector(".js-diff-progressive-loader");t&&t.addEventListener("load",(function(){Fe(e)}))})),r(".js-diff-load-container",(function(e){const t=e.querySelector(".js-diff-entry-loader");t&&t.addEventListener("load",(function(){e.closest(".js-file").classList.remove("hide-file-notes-toggle");const t=Ne();t&&Be(e,t)}))})),o("click",".js-diff-load",(function(e){if(e.target.classList.contains("js-ignore-this"))return;Ue(e.currentTarget.closest(".js-diff-load-container"))})),o("click",".js-rendered, .js-source",(function(e){const t=e.currentTarget;t.classList.contains("selected")?e.preventDefault():(function(e){const t=e.closest(".js-file-header"),n=e.classList.contains("js-rendered"),s=e.classList.contains("js-source"),o=t.getAttribute("data-short-path"),r=t.getAttribute("data-anchor"),i=new URL(window.location.href,window.location.origin),c=new URLSearchParams(i.search.slice(1));i.hash=r,n?c.set("short_path",o):s&&c.delete("short_path");i.search=c.toString(),u(null,"",i.toString())}(t),function(e){for(const t of document.querySelectorAll(".js-rendered, .js-source"))t.classList.remove("selected"),t.removeAttribute("aria-current");e.classList.add("selected"),e.setAttribute("aria-current","true")}(t))})),i(".js-prose-diff-toggle-form",(async function(e,t){const n=e.closest(".js-details-container"),s=n.querySelector(".js-file-content"),o=await t.html();for(;s.lastChild;)s.removeChild(s.lastChild);s.append(o.html),n.classList.toggle("display-rich-diff"),n.classList.toggle("show-inline-notes")})),o("change",".js-diff-style-toggle input",(function(e){if(!(e.target instanceof Element))return;const t=e.target.closest(".js-diff-settings");for(const n of t.querySelectorAll(".js-diff-style-toggle label"))n.classList.toggle("selected")})),o("click",".js-toc-retry",(function(e){if(!(e.target instanceof Element))return;const t=e.target.closest(".select-menu").querySelector("include-fragment"),n=t.getAttribute("src");t.setAttribute("src",""),t.setAttribute("src",n)})),o("details-menu-select",".js-pull-base-branch-menu",(function(){const e=document.querySelector(".js-change-base-template").content.cloneNode(!0);e instanceof DocumentFragment&&w({content:e})}),{capture:!0}),r(".js-diffbar-range-menu .js-diffbar-range-list",{subscribe:function(e){const t=e.closest("details-menu"),n=e.classList.contains("js-diffbar-invert-range");let s=!1;function o(e){s=e.shiftKey,s&&e.preventDefault()}function r(t){if(!s)return;t.preventDefault();const o=t.detail.relatedTarget;if(o.classList.contains("is-range-selected")){t.stopPropagation();const s=e.querySelectorAll(".is-range-selected"),o=n?s.length-1:0,r=n?0:s.length-1,i=s[o],c=s[r],l=e.getAttribute("data-range-url"),a=i.getAttribute("data-parent-commit"),u=c.getAttribute("data-commit"),d=a&&u?`${a}..${u}`:u,m=l.replace("$range",d);E({url:m,container:document.querySelector("#js-repo-pjax-container")})}else t.stopImmediatePropagation(),async function(e,t){function n(n){We(e,t,n.target.closest('[role="menuitem"]'))}We(e,t,t),e.addEventListener("mouseover",n),await new Promise((e=>window.addEventListener("keyup",e,{once:!0}))),e.removeEventListener("mouseover",n),Oe(e)}(e,o)}return e.addEventListener("click",o,{capture:!0}),t.addEventListener("details-menu-select",r),{unsubscribe:()=>{e.removeEventListener("click",o,{capture:!0}),t.removeEventListener("details-menu-select",r)}}}}),o("toggle",".js-diffbar-range-menu",(function(e){const t=e.currentTarget;if(!t.hasAttribute("open"))return;const n=t.querySelector(".in-range");n&&n.focus()}),{capture:!0}),o("click",".js-compare-tab",(function(e){for(const n of document.querySelectorAll(".js-compare-tab.selected"))n.classList.remove("selected");e.currentTarget.classList.add("selected");for(const n of document.querySelectorAll("#commits_bucket, #files_bucket, #commit_comments_bucket"))n.classList.add("d-none");const t=e.currentTarget.hash;document.querySelector(t).classList.remove("d-none"),e.preventDefault()})),m((function({target:e}){if(!(e instanceof HTMLElement))return;const t=e.closest("#commits_bucket, #files_bucket, #commit_comments_bucket");t&&t instanceof HTMLElement&&!T(t)&&document.querySelector(`.js-compare-tab[href="#${t.id}"]`).click()})),o("click",".js-toggle-range-editor-cross-repo",(function(){document.querySelector(".js-range-editor").classList.toggle("is-cross-repo")})),o("pjax:click",".js-range-editor",(function(e){const t=document.querySelector(".js-compare-pr");if(t&&t.classList.contains("open")){const t=e.detail.options,n=new URL(t.url,window.location.origin);n.search.match(/expand=1/)||(n.search+=(n.search?"&":"")+"expand=1",t.url=n.toString())}})),r(".js-compare-pr.open",{add(){document.body.classList.add("is-pr-composer-expanded")},remove(){document.body.classList.remove("is-pr-composer-expanded")}}),o("change",".js-collab-checkbox",(function({currentTarget:e}){const t=e.form;for(const s of t.querySelectorAll(".errored"))s.classList.remove("errored");const n=e.closest(".js-collab-option").querySelector(".js-status-indicator");n.classList.remove("status-indicator-success","status-indicator-failed"),n.classList.add("status-indicator-loading")})),i(".js-collab-form",(async function(e,t){try{await t.text()}catch(n){for(const t of e.querySelectorAll(".status-indicator-loading")){t.classList.remove("status-indicator-loading"),t.classList.add("status-indicator-failed");const e=t.closest(".js-collab-option");e.classList.add("errored");const n=e.querySelector(".js-collab-checkbox");n.checked=!n.checked}for(const t of e.querySelectorAll(".status-indicator-success"))t.classList.remove("status-indicator-success");return}for(const s of e.querySelectorAll(".errored"))s.classList.remove("errored");for(const s of e.querySelectorAll(".status-indicator-loading"))s.classList.remove("status-indicator-loading"),s.classList.add("status-indicator-success")})),r(".js-timeline-item > .js-commit-group",{constructor:HTMLElement,add(e){if(e.querySelector(".js-commit-group-header"))return;const t=e.closest(".js-timeline-item");if(!(t instanceof HTMLElement))return;let n=t.previousElementSibling;n instanceof HTMLElement&&(n.classList.contains("js-timeline-item")||(n=n.previousElementSibling,n instanceof HTMLElement))&&n.querySelector(".js-commit-group")&&function(e,t){const n=e.querySelector(".js-commit-group-commits"),s=t.querySelectorAll(".js-commit-group-commits > .js-commit");for(const r of s)r.classList.toggle("py-3"),n.appendChild(r);const o=e.querySelector(".js-commit-group-count");o instanceof HTMLElement&&(o.textContent=""+n.querySelectorAll(".js-commit").length),t.remove()}(n,t)}}),o("details:toggled",".js-pull-merging",(function({currentTarget:e}){const t=Array.from(e.querySelectorAll(".js-merge-pull-request")),n=t.some(T);for(const s of t)s.classList.toggle("is-dirty",n)})),o("click",".js-merge-box-try-again",(async function({currentTarget:e}){const t=e.getAttribute("data-form-target");if(!["js-cleanup-branch-form","js-merge-branch-form","js-queue-branch-form","js-update-branch-form"].includes(t))return;const n=e.closest(".js-pull-merging").getElementsByClassName(t)[0];l(n,"submit")})),document.addEventListener("session:resume",(function(e){const t=document.getElementById(e.detail.targetId);if(t){const e=t.closest(".js-merge-pull-request");if(e){const t=e.closest(".js-details-container");t&&t.classList.add("open")}}})),o("change",".js-merge-button-toggle",(function({currentTarget:e}){const t=e.closest(".js-merge-pr"),n=!e.checked;for(const s of t.querySelectorAll(".js-merge-commit-button"))s.disabled=n})),o("change",".js-auto-merge-admin-override",(function({currentTarget:e}){const t=e.closest(".js-merge-message-container"),n=e.checked,s=t.querySelector(".js-merge-box"),o=t.querySelector(".js-auto-merge-box"),r=t.querySelector(".js-merge-form"),i=t.querySelector(".js-auto-merge-form"),c=t.querySelectorAll(".js-merge-menu-item"),l=t.querySelectorAll(".js-auto-merge-menu-item");if(s.hidden=!n,o.hidden=n,r.hidden=!n,i.hidden=n,n)for(let a=0;a<l.length;a++){const e=l[a].getAttribute("aria-checked");null!==e&&c[a].setAttribute("aria-checked",e)}else for(let a=0;a<c.length;a++){const e=c[a].getAttribute("aria-checked");null!==e&&l[a].setAttribute("aria-checked",e)}})),o("details-menu-selected",".js-merge-method-menu",(function(e){const t=e.detail.relatedTarget,n=t.closest(".js-merge-pr"),s=n.querySelector(".js-merge-pull-request"),o=n.querySelector(".js-auto-merge-admin-override"),r=n.querySelector(".js-merge-method-menu-button"),i=r.getAttribute("data-merge-button-class");r.classList.toggle("btn-danger",t.hasAttribute("data-dangerous-action")),i&&r.classList.toggle(i,!t.hasAttribute("data-dangerous-action"));const c=n.querySelector(".js-merge-title"),l=n.querySelector(".js-merge-message");c.defaultValue===c.value&&(c.defaultValue=c.value=t.getAttribute("data-input-title-value"));l.defaultValue===l.value&&(l.defaultValue=l.value=t.getAttribute("data-input-message-value"));n.classList.toggle("is-merging","merge"===t.value),n.classList.toggle("is-squashing","squash"===t.value),n.classList.toggle("is-rebasing","rebase"===t.value),n.classList.toggle("is-merging-group","group"===t.value),n.classList.toggle("is-merging-solo","solo"===t.value),n.classList.toggle("is-merging-jump","jump"===t.value);const a=s.classList.contains("js-admin-override-merge")&&"merge"===t.value||s.classList.contains("js-admin-override-squash")&&"squash"===t.value||s.classList.contains("js-admin-override-rebase")&&"rebase"===t.value,u=n.querySelectorAll(".js-admin-override");for(const b of u)b.hidden=!a||null!==o;const d=n.querySelector(".js-merge-type");d&&(d.value=t.value);const m=a&&!n.querySelector(".js-merge-button-toggle").checked,g=n.querySelectorAll(".js-merge-pull-request .js-merge-commit-button");for(const b of g)b.type=t.value===b.value?"submit":"button",b.disabled=m;s.classList.toggle("color-text-danger",a);const f=n.closest(".js-pull-merging"),h=new URL(f.getAttribute("data-url"),window.location.origin),p=new URLSearchParams(h.search);p.set("merge_type",t.value),h.search=p.toString(),f.setAttribute("data-url",h.toString())}),{capture:!0}),o("details:toggled",".js-merge-pr",(function(e){const t=e.currentTarget.querySelector(".js-merge-message");t&&l(t,"change")})),r(".branch-action-item.js-details-container.open",{add(e){for(const t of e.querySelectorAll(".js-merge-review-section"))t.setAttribute("open","")},remove(e){for(const t of e.querySelectorAll(".js-merge-review-section"))t.removeAttribute("open")}}),o("toggle",".js-details-container .js-merge-review-section",(function({currentTarget:e}){const t=e.closest(".js-details-container"),n=t.querySelectorAll(".js-merge-review-section").length,s=t.querySelectorAll(".js-merge-review-section[open]").length,o=s===n;0===s?k(t,{force:!1}):o&&k(t,{force:!0})}),{capture:!0}),r("poll-include-fragment[data-to-be-polled]",{constructor:c,add(e){function t(){e.src=e.getAttribute("data-to-be-polled"),e.removeAttribute("data-to-be-polled")}document.hidden?document.addEventListener("visibilitychange",t,{once:!0}):t()}});let ze=!1;function Qe(){const e=document.querySelectorAll(".pull-request-ref-restore");for(let t=0;t<e.length;t++)e[t].classList.toggle("last",t===e.length-1)}function Xe(){const e=null!=document.querySelector("#js-pull-restorable"),t=document.querySelector(".js-pull-discussion-timeline");t&&t.classList.toggle("is-pull-restorable",e)}function Ve(){const e=document.querySelector(".js-reviews-container");e&&setTimeout((()=>function(e){const t=e.closest(".js-review-state-classes"),n=t.querySelectorAll(".js-pending-review-comment").length,s=document.querySelector(".js-review-changes");t.classList.toggle("is-review-pending",n>0);for(const o of document.querySelectorAll(".js-pending-review-comment-count"))o.textContent=String(n);for(const o of document.querySelectorAll(".js-pending-comment-count-type"))o instanceof HTMLElement&&(o.textContent=o.getAttribute(1===n?"data-singular-string":"data-plural-string"));if(n>0){s.textContent=s.getAttribute("data-pending-message")||"";const t=e.querySelector(".js-reviews-toggle");t.classList.add("anim-pulse-in"),t.addEventListener("animationend",(()=>t.classList.remove("anim-pulse-in")),{once:!0})}else s.textContent=s.getAttribute("data-message")||""}(e)))}function Ke(e){return e.getAttribute("ratio").split("/")}function Je(e){if(e){const[t,n]=Ke(e),s=parseInt(t)/parseInt(n),o=e.querySelector(".js-review-progress"),r=e.querySelector(".js-review-count");o instanceof HTMLElement&&r&&(o.style.width=100*s+"%",r.textContent=`${t} / ${n}`)}}document.addEventListener("keydown",(function(e){"Alt"===e.key&&(ze=!0)})),document.addEventListener("keyup",(function(e){"Alt"===e.key&&(ze=!1)})),o("click",".js-toggle-outdated-comments",(function(e){if(!((e instanceof MouseEvent&&e.altKey||ze)&&e.currentTarget instanceof HTMLElement))return;const t=e.currentTarget,n=t.closest("details");function s(){const e=n.hasAttribute("open");for(const n of document.querySelectorAll(".js-toggle-outdated-comments"))if(n!==t){n.closest("details").toggleAttribute("open",e)}}setTimeout((()=>{x(t,s)}))})),r(".pull-request-ref-restore",{add:Qe,remove:Qe}),r("#js-pull-restorable",{add:Xe,remove:Xe}),i(".js-inline-comment-form",(async function(e,t){await t.text(),Ve()})),i(".js-pending-review-comment .js-comment-delete",(async function(e,t){await t.text(),Ve()})),i(".js-resolvable-timeline-thread-form",(async function(e,t){try{const n=await t.html();e.closest(".js-resolvable-timeline-thread-container").replaceWith(n.html)}catch(n){_()}})),o("click",".js-resolvable-thread-toggler",(function(e){if(!(e.target instanceof HTMLElement))return;const t=e.target.closest(".js-resolvable-timeline-thread-container");e.target.closest(".js-resolvable-thread-toggler-container").classList.toggle("border-bottom");t.querySelector(".js-resolvable-thread-contents").classList.toggle("d-none");for(const n of t.querySelectorAll(".js-resolvable-thread-toggler"))n.classList.toggle("d-none")})),i(".js-toggle-user-reviewed-file-form",(async function(e,t){const n=e.closest(".js-details-container"),s=!!n.querySelector(".js-reviewed-file"),o=n.classList.contains("open"),r=n.querySelector(".js-file-header"),i=!!r&&60===r.getBoundingClientRect().top;(!s&&o||s&&!o)&&(k(n),i&&f(n));const c=e.querySelector(".js-reviewed-toggle");s?(c.classList.remove("bg-blue-2","border-blue-light"),c.classList.add("color-text-secondary","color-border-tertiary")):(c.classList.remove("color-text-secondary","color-border-tertiary"),c.classList.add("bg-blue-2","border-blue-light"));c.querySelector(".js-reviewed-checkbox").disabled=!0;const l=document.querySelector("progress-bar");l instanceof ProgressBarElement&&(s?l.decrement():l.increment());const a=await t.html(),u=e.closest(".js-replace-file-header-review");u&&(u.replaceWith(a.html),n.hasAttribute("data-file-user-viewed")?n.removeAttribute("data-file-user-viewed"):n.setAttribute("data-file-user-viewed","true"))}));class ProgressBarElement extends HTMLElement{static get observedAttributes(){return["ratio"]}attributeChangedCallback(e){"ratio"===e&&Je(this)}connectedCallback(){Je(this)}increment(){const[e,t]=Ke(this),n=Math.min(parseInt(e)+1,parseInt(t));this.setAttribute("ratio",`${n}/${t}`)}decrement(){const[e,t]=Ke(this),n=Math.min(parseInt(e)-1,parseInt(t));this.setAttribute("ratio",`${n}/${t}`)}}function Ge(e){L(e),f(e)}async function Ye(e,t){const{anchor:n,side:s,line:o,lastLine:r,hashFragment:i,partialHashFragment:c}=e,l=A(document,n);if(!l)return;const a=l.nextElementSibling;if(!a)return;const u=tt(a,s,o,r);if(!u.length){const e=A(document,i);if(e)return void Ge(e);const t=a.querySelector(".js-diff-load-container");if(!t)return;try{await function(e){const t=e.querySelector(".js-diff-entry-loader"),n=e.querySelector(".js-diff-placeholder"),s=e.querySelector("button.js-diff-load"),o=e.querySelector(".js-button-text");n.setAttribute("fill","url('#animated-diff-gradient')"),o.textContent=s.getAttribute("data-disable-with")||"",s.disabled=!0;const r=new URL(t.getAttribute("data-fragment-url")||"",window.location.origin);return t.src=r.toString(),t.data}(t);const e=A(document,i);e instanceof HTMLElement&&Ge(e)}catch(m){Ge(a)}return}await function(e,t){return Promise.all(e.map((e=>Ze(e,t))))}(u,c);const d=A(document,i);tt(a,s,o,r).length?Ye(e,t):d?Ge(d):t<1&&Ye(e,t+1)}async function Ze(e,t){let n;if(t){const s="R"===t.slice(-1)?"data-right-range":"data-left-range",o=e.getAttribute(s)||"";n=t+parseInt(o.split("-")[0],10)}else n=e.hash.slice(1);const s=e.getAttribute("data-url"),o=new URL(s,window.location.origin),r=new URLSearchParams(o.search.slice(1));r.append("anchor",n),o.search=r.toString(),""!==window.location.hash&&window.history.replaceState(null,"","#");const i=await b(document,o.toString()),c=e.closest(".js-file"),l=e.closest(".js-expandable-line"),a=et(l,".file-diff-line");a?x(a,(()=>{l.replaceWith(i)})):l.replaceWith(i),function(e){const t=e.querySelector(".js-expand-full-wrapper");if(!t)return;0===Array.from(e.querySelectorAll(".js-expand")).length&&t.parentElement.removeChild(t)}(c)}function et(e,t){const n=e.nextElementSibling;return n instanceof HTMLElement&&n.matches(t)?n:null}function tt(e,t,n,s){const o=parseInt(n,10),r=parseInt(s||"",10);return Array.from(e.querySelectorAll(".js-expand")).filter((e=>{const n="R"===t?"data-right-range":"data-left-range",s=(e.getAttribute(n)||"").split("-"),i=parseInt(s[0],10),c=parseInt(s[1],10);return i<=o&&o<=c||(o<=i&&c<=r||i<=r&&r<=c)}))}window.customElements.get("progress-bar")||(window.ProgressBarElement=ProgressBarElement,window.customElements.define("progress-bar",ProgressBarElement)),document.addEventListener("pjax:end",(function(){for(const e of document.querySelectorAll(".js-pull-refresh-on-pjax"))C(e)})),r(".js-multi-line-callout",(function(e){const t=document.querySelector(".js-linkable-line-number");if(!t)return;if(t.closest(".js-diff-table").offsetHeight<343)return;const n=t.closest("tr");if(!n)return;const s=n.lastElementChild;s&&(e.remove(),s.prepend(e),e.removeAttribute("hidden"))})),o("submit",".js-multi-line-callout",(function(e){if(!(e.target instanceof Element))return;e.target.closest(".js-multi-line-callout").hidden=!0})),o("click",".js-dismiss-multi-line-suggestion-onboarding-notice",(async function(e){const t=e.currentTarget.getAttribute("data-url"),n=e.currentTarget.parentElement.querySelector(".js-data-url-csrf"),s=new FormData;s.append("notice","multi_line_suggestions");if((await fetch(t,{method:"POST",mode:"same-origin",body:s,headers:{"Scoped-CSRF-Token":n.value,"X-Requested-With":"XMLHttpRequest"}})).ok){const e=document.querySelectorAll(".js-multi-line-suggestion-onboarding-notice");for(const t of e)t.remove()}})),r(".js-updating-pull-request-commits-count",{add(e){const t=e.textContent,n=document.querySelectorAll(".js-updateable-pull-request-commits-count");for(const s of n)s.textContent=t}}),(async()=>{if(await M,window.performance&&window.performance.navigation&&window.performance.navigation.type===window.performance.navigation.TYPE_RELOAD){const e=document.getElementById("js-report-pull-request-refresh");e&&I(e)}})(),m((function(){const e=function(e){if(!e)return;const t=H(e);if(!t)return;const n=t[1],s=t[2],o=t[3],r=t[5];return{anchor:n,side:s,line:o,lastLine:r,hashFragment:n+s+o,partialHashFragment:n+s}}(window.location.hash);e&&(A(document,e.hashFragment)&&!e.lastLine||Ye(e,0))})),o("click",".js-expand",(function(e){e.preventDefault(),Ze(e.currentTarget)})),o("click",".js-expand-full",(async e=>{e.preventDefault();const t=e.currentTarget,n=t.closest(".file"),s=t.getAttribute("data-url"),o=function(e){const t=Array.from(e.querySelectorAll(".js-expand")).map(((e,t)=>function(e,t){const n=new URL(e.getAttribute("data-url"),window.location.origin).searchParams;return{position:t.toString(),left:{start:n.get("last_left"),end:n.get("left"),size:n.get("left_hunk_size")},right:{start:n.get("last_right"),end:n.get("right"),size:n.get("right_hunk_size")}}}(e,t)));let n=!1;const s=[];for(let o=0;o<t.length;o++){if(n){n=!1;continue}const e=t[o],r=t[o+1];n=r&&e.left.start===r.left.start&&e.left.end===r.left.end&&e.right.start===r.right.start&&e.right.end===r.right.end,s.push(e)}return s}(n);if(0===o.length)return;const r=new URL(s,window.location.origin),i=new URLSearchParams(r.search.slice(1));for(const a of o)i.append("ranges[]last_left",a.left.start),i.append("ranges[]left",a.left.end),i.append("ranges[]left_hunk_size",a.left.size),i.append("ranges[]last_right",a.right.start),i.append("ranges[]right",a.right.end),i.append("ranges[]right_hunk_size",a.right.size),i.append("ranges[]position",a.position);r.search=i.toString();const c=await async function(e,t){const n=await self.fetch(t,{headers:{"Content-Type":"application/json",Accept:"application/json"}});if(!n.ok)throw new Error("Request to blob_expand failed with status code "+n.status);return R(P(e),n,!0),(await n.json()).map((t=>Object.assign(Object.assign({},t),{content:a(e,t.content)})))}(document,r.toString()),l=[...n.querySelectorAll(".js-expand")];for(const{content:a,position:d}of c){const e=l[parseInt(d,10)];if(!e)return;const t=e.closest(".js-expandable-line"),n=et(t,".file-diff-line");n?x(n,(()=>{t.after(a)})):t.after(a),t.setAttribute("hidden","true")}t.setAttribute("hidden","true");const u=n.querySelector(".js-collapse-diff");u&&u.removeAttribute("hidden"),n.classList.add("open"),n.classList.add("Details--on")})),o("click",".js-collapse-diff",(e=>{const t=e.currentTarget,n=t.closest(".file"),s=[...n.querySelectorAll('.blob-expanded[data-expanded-full="true"]')];for(const i of s)i.parentElement.removeChild(i);const o=[...n.querySelectorAll(".js-expandable-line")];for(const i of o)i.removeAttribute("hidden");t.setAttribute("hidden","true");const r=n.querySelector(".js-expand-full");r&&r.removeAttribute("hidden")}));class DiffTableSideProtection{constructor(e){this.selection=e,this.anchorNode=e.anchorNode}range(){var e;let t;return(null===(e=this.selection)||void 0===e?void 0:e.rangeCount)>0&&(t=this.selection.getRangeAt(0)),t}canBeSideProtected(){try{return!(!this.hasSelectedText()||!this.confinedTable())}catch(e){return!1}}isSideProtected(){var e;try{return!!(null===(e=this.confinedTable())||void 0===e?void 0:e.getAttribute("data-lock-side-selection"))}catch(t){return!1}}hasSelectedText(){const e=this.range();return!!e&&e.toString().length>0}clearSelectedText(){this.selection.removeAllRanges()}confinedTable(){var e,t;const n=null===(t=null===(e=this.range())||void 0===e?void 0:e.commonAncestorContainer)||void 0===t?void 0:t.parentElement;if(null==n?void 0:n.matches(".diff-table"))return n;if(null==n?void 0:n.matches(".js-file-content")){return null==n?void 0:n.querySelector("table.diff-table")}return null==n?void 0:n.closest("table.diff-table")}unprotectedSide(){var e,t;let n;return n=this.anchorNode instanceof HTMLTableCellElement?this.anchorNode.closest("td[data-split-side]"):null===(t=null===(e=this.anchorNode)||void 0===e?void 0:e.parentElement)||void 0===t?void 0:t.closest("td[data-split-side]"),null==n?void 0:n.getAttribute("data-split-side")}protectedSide(){return"left"===this.unprotectedSide()?"right":"left"}applySideProtection(){if(this.unprotectedSide()){const e=this.confinedTable(),t=this.unprotectedSide();e&&t&&e.setAttribute("data-lock-side-selection",t)}}clearSideProtection(){const e=document.querySelectorAll("table[data-lock-side-selection]");for(const t of e){t.removeAttribute("data-lock-side-selection")}}filteredTableRows(){const e=[];for(let t=0;t<this.selection.rangeCount;t++){const n=this.selection.getRangeAt(t).cloneContents();if(n.querySelectorAll("td").length){const t=`td[data-split-side=${this.protectedSide()}], td.js-linkable-line-number, td.empty-cell`,s=n.querySelectorAll(t);for(const e of s)e.parentNode&&e.parentNode.removeChild(e);e.push(...n.children)}else{const t=document.createElement("TR"),s=document.createElement("TD");s.append(...n.childNodes),t.append(s),e.push(t)}}return e}contentToString(){var e;const t=[],n=document.createElement("table");n.classList.add("invisible"),n.append(...this.filteredTableRows()),null===(e=this.confinedTable())||void 0===e||e.append(n);const s=n.children;for(let o=0;o<s.length;o++){const e=s[o].innerText;e&&("\n"===e?t.push(""):t.push(e))}return n.remove(),t.join("\n")}}function nt(e){return Math.floor(e/2)}function st(e,t){const n=e.parentElement;if(!n)return;const s=n.children;let o;if(4===s.length)for(let r=0,i=s.length;r<i;r++){s[r]===e&&(o=nt(r))}for(let r=0,i=s.length;r<i;r++){const e=s[r];null!=o&&nt(r)!==o||e.classList.toggle("is-hovered",t)}}function ot(e){var t;const n=document.getSelection();if(n){const s=new DiffTableSideProtection(n);s.isSideProtected()&&(null===(t=e.clipboardData)||void 0===t||t.setData("text/plain",s.contentToString()),e.preventDefault())}}function rt(e){const t=document.getSelection(),n=2===e.button;if(t&&!n){const e=new DiffTableSideProtection(t);e.isSideProtected()&&(e.clearSelectedText(),e.clearSideProtection())}}function it(){const e=document.getSelection();if(e){const t=new DiffTableSideProtection(e);t.canBeSideProtected()?t.applySideProtection():t.clearSideProtection()}}function ct(){const e=document.querySelector("meta[name=diff-view]"),t=e&&e instanceof HTMLMetaElement?e.content:"",n=document.querySelector(".js-file-diff-split"),s=!!("split"===t&&n||document.querySelector(".wants-full-width-container"));document.body.classList.toggle("full-width",s)}function lt(e){const t=e.some((e=>e.checked));for(const n of e)h(n,!t)}function at(e){const t=e.parentElement,n=t.querySelectorAll("td.js-line-comments").length,s=t.querySelectorAll("td.js-line-comments.is-collapsed").length;t.classList.toggle("is-collapsed",s>0&&n===s)}r(".diff-table",(function(e){let t=null;function n(){t&&st(t,!1),t=null}function s(e){t&&st(t,!1),e.target instanceof HTMLElement&&(t=e.target.closest("td.blob-code"),t&&st(t,!0))}return{add:function(){e.addEventListener("mouseenter",n),e.addEventListener("mouseleave",n),e.addEventListener("mouseover",s)},remove:function(){e.removeEventListener("mouseenter",n),e.removeEventListener("mouseleave",n),e.removeEventListener("mouseover",s)}}})),r(".js-diff-container",(function(e){return{add:function(){e.querySelectorAll(".js-feature-enabled-split-diff-copy-protection")&&(document.addEventListener("copy",ot),document.addEventListener("mousedown",rt),document.addEventListener("selectionchange",it))},remove:function(){e.querySelectorAll(".js-feature-enabled-split-diff-copy-protection")&&(document.removeEventListener("copy",ot),document.removeEventListener("mousedown",rt),document.removeEventListener("selectionchange",it))}}})),r("meta[name=diff-view]",{add:ct,remove:ct}),r(".js-file-diff-split",{add:ct,remove:ct}),r(".js-compare-tab.selected",{add:ct,remove:ct}),r(".wants-full-width-container",{add:ct,remove:ct}),o("change",".js-toggle-file-notes",(function(e){const t=e.currentTarget;t.closest(".file").classList.toggle("show-inline-notes",t.checked)})),o("click",".js-toggle-all-file-notes",(function(e){lt(Array.from(document.querySelectorAll(".js-toggle-file-notes"))),e.preventDefault()})),o("click",".js-toggle-all-file-annotations",(function(e){lt(Array.from(document.querySelectorAll(".js-toggle-file-check-annotations"))),e.preventDefault()})),r(".js-inline-comments-container",(function(e){let t;const n=e.closest(".file");if(n){return{add:t=function(){const e=null!=n.querySelector(".js-inline-comments-container");n.classList.toggle("has-inline-notes",e)},remove:t}}})),o("change",".js-toggle-file-check-annotations",(function(e){const t=e.currentTarget,n=t.closest(".file").querySelectorAll(".js-inline-annotations");for(const s of n)s instanceof HTMLElement&&(s.hidden=!t.checked)})),r("td.js-line-comments.is-collapsed",{add:at,remove:at})}}}));
//# sourceMappingURL=diffs-1bc19d30.js.map
